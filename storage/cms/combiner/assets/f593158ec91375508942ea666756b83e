  var gmarkers = [];
  // var gicons = [];
  var map = null;
  var webserviceurl = 'http://localhost/webservices/storelocator.asmx';
  var infowindow = new google.maps.InfoWindow({
    size: new google.maps.Size(150,50)
  });

    function initialize() {
      var myOptions = {
        zoom: 13,
        center: new google.maps.LatLng(-37.82263, 144.9322423,17),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      }
      map = new google.maps.Map(document.getElementById("map"), myOptions);
      google.maps.event.addListener(map, 'click', function() {
        infowindow.close();
      });
      // // Change this depending on the name of your  file
      // downloadUrl("stores.xml", function(data) {
      //   var xml = data.responseXML;
      //   var markers = xml.documentElement.getElementsByTagName("store");
        
      //   for (var i = 0; i < markers.length; i++) {
      //     var name = markers[i].getAttribute("name");
      //     var address1 = markers[i].getAttribute("address1");
      //     var address2 = markers[i].getAttribute("address2");
      //     var postcode = markers[i].getAttribute("state");
      //     var lat = parseFloat(markers[i].getAttribute("latitude"));
      //     var lng = parseFloat(markers[i].getAttribute("longitude"));
      //     var point = new google.maps.LatLng(lat,lng);
      //     var html = "" + name + " " + address1 + " " + postcode;
      //     var store = createMarker(point,name,html,postcode);
      //   }
      // });
      // $( "div.checkradios-checkbox" ).on( "click", function() {
      // if(!($(this).hasClass("unchecked"))){
        // var division = $(this).children("input").data("ref");
        var url = webserviceurl + "/GetAllStoresLatLong";
        //var clear = false;
        //var params = "division=" + division;
        searchLocations(url);
        return;
      // }
      // });
    }

  function searchLocations(url) {
   

    // var radius = document.getElementById('radiusSelect').value;
    // var searchUrl = 'phpsqlsearch_genxml.php?lat=' + center.lat() + '&lng=' + center.lng() + '&radius=' + radius;
      var searchUrl = url   
      downloadUrl(searchUrl,function(data) {
      var xml = data.responseXML;
      var markerNodes = xml.getElementsByTagName("Store");
      var bounds = new google.maps.LatLngBounds();
      for (var i = 0; i < markerNodes.length; i++) {
        // console.log(markerNodes[i].getElementsByTagName("Store"));
        // var xmlNode = parseXml(.innerHTML);
        // console.log(xmlNode);
        var name = xml.getElementsByTagName("Name")[i].childNodes[i].nodeValue;
        var address1 = xml.getElementsByTagName("Address1")[i].childNodes[i].nodeValue;
        var address2 = xml.getElementsByTagName("Address2")[i].childNodes[i].nodeValue;
        //var distance = parseFloat(markerNodes[i].getAttribute("distance"));
        var latlng = new google.maps.LatLng(
        parseFloat(xml.getElementsByTagName("Latitude")[i].childNodes[i].nodeValue),
        parseFloat(xml.getElementsByTagName("Longitude")[i].childNodes[i].nodeValue)
        );

        //createOption(name, distance, i);
        createMarker(latlng, name, address2);
        bounds.extend(latlng);  
      }
      map.fitBounds(bounds);
      // 
      // locationSelect.style.visibility = "visible";

      // locationSelect.onchange = function() {
      //   var markerNum = locationSelect.options[locationSelect.selectedIndex].value;
      //   google.maps.event.trigger(markers[markerNum], 'click');
      // };
    });
  }
  
   // A function to create the marker and set up the event window
  function createMarker(latlng,name,address) {
    console.log(latlng);
    console.log(name);
    console.log(address);
    var html = "<b>" + name + "</b> <br/>" + address;
    var marker = new google.maps.Marker({
      position: latlng,
      map: map,
      title: name,
      // zIndex: Math.round(latlng.lat()*-100000)<<5
    });

    // // === Store the type and name info as a marker properties ===
    // marker.mytype = type;
    // marker.myname = name;
    // gmarkers.push(marker);

    google.maps.event.addListener(marker, 'click', function() {
      infowindow.setContent(contentString);
      infowindow.open(map,marker);
    });
  }

  function downloadUrl(url, params, callback) {  
      var request = window.ActiveXObject ? 
      new ActiveXObject('Microsoft.XMLHTTP') : new XMLHttpRequest;   
      request.onreadystatechange = function() {    
        if (request.readyState == 4) {  
          request.onreadystatechange = doNothing;          
          callback(request);    
        } 
      };   
      request.open('POST', url, true);  
      request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      request.send(params); 
  }

  function parseXml(str) {
      if (window.ActiveXObject) {
        var doc = new ActiveXObject('Microsoft.XMLDOM');
        doc.loadXML(str);
        return doc;
      } else if (window.DOMParser) {
        return (new DOMParser).parseFromString(str, 'text/xml');
      }
    }

   function doNothing() {}

  


    //]]>
  